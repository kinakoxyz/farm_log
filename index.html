<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¾²åœ’ãƒ­ã‚° ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nosleep/0.12.0/NoSleep.min.js"></script>
    <style>
        body { background: #000; color: #0f0; font-family: sans-serif; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        
        .timer-section { width: 100%; text-align: center; background: #111; padding: 10px 0; border-bottom: 1px solid #333; }
        #clock { font-size: 2.8rem; font-weight: bold; color: #fff; line-height: 1.1; }
        #countdown { font-size: 1.3rem; color: #ff3333; margin-top: 5px; font-weight: bold; }

        #log-container { 
            width: 95%; height: 50vh; 
            border: 2px solid #00ff00; background: #000; padding: 10px;
            margin-top: 10px; text-align: left; overflow-y: auto; white-space: pre-wrap;
            font-size: 1.4rem; line-height: 1.5; font-family: 'Courier New', monospace;
            box-sizing: border-box;
        }

        /* ç‰¹åˆ¥è¨­å®šã‚¨ãƒªã‚¢ï¼ˆéŸ³å£°ã¨ã‚¹ãƒªãƒ¼ãƒ—ï¼‰ */
        #core-settings {
            width: 95%; margin-top: 15px; display: flex; justify-content: space-around; gap: 10px;
        }
        .core-item { 
            flex: 1; padding: 15px; border-radius: 10px; font-weight: bold; text-align: center; font-size: 1.1rem;
            border: 2px solid #555; cursor: pointer;
        }
        .active-audio { background: #aa7700; color: #fff; border-color: #ffaa00; }
        .active-nosleep { background: #005500; color: #fff; border-color: #00ff00; }

        .settings-header { color: #aaa; font-size: 0.9rem; margin-top: 20px; margin-bottom: 10px; }
        #settings { 
            background: #222; border: 1px solid #444; padding: 10px; width: 95%;
            display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-bottom: 30px;
        }
        .check-item { background: #333; padding: 10px 12px; border-radius: 6px; font-size: 1rem; color: #fff; display: flex; align-items: center; }
        input[type="checkbox"] { transform: scale(1.6); margin-right: 10px; }
        
        button.ctrl-btn { padding: 10px 15px; font-size: 1rem; margin: 5px; background: #444; color: #fff; border: none; border-radius: 4px; }
    </style>
</head>
<body>

    <div class="timer-section">
        <div id="clock">00:00:00</div>
        <div id="countdown">æ›´æ–°ã¾ã§: --ç§’</div>
    </div>

    <div id="log-container">ãƒ­ã‚°èª­ã¿è¾¼ã¿ä¸­...</div>

    <div id="core-settings">
        <label id="audio-label" class="core-item">
            <input type="checkbox" id="audio-switch" style="display:none;"> ğŸ”Š éŸ³å£°é€šçŸ¥
        </label>
        <label id="nosleep-label" class="core-item">
            <input type="checkbox" id="nosleep-switch" style="display:none;"> ğŸš« ã‚¹ãƒªãƒ¼ãƒ—é˜²æ­¢
        </label>
    </div>

    <div class="settings-header">â–¼ é€šçŸ¥éŸ³ã‚’é³´ã‚‰ã™ç¨®ã‚’é¸æŠ</div>
    <div id="settings">
        <div id="check-list-container" style="display:contents;"></div>
        <div style="width:100%; text-align:center; margin-top:10px;">
            <button class="ctrl-btn" onclick="allCheck(true)">å…¨é¸æŠ</button>
            <button class="ctrl-btn" onclick="allCheck(false)">å…¨è§£é™¤</button>
        </div>
    </div>

    <script>
        const GIST_URL = "https://gist.githubusercontent.com/kinakoxyz/9b9509f9f4a9139ad6196042de197560/raw/";
        let lastContent = "";
        let nextRefreshTime = null;
        const noSleep = new NoSleep();

        // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆç¨®ãƒªã‚¹ãƒˆ
        const TARGETS = [
            "ã‚¹ãƒ—ãƒªãƒ³ã‚¯ãƒ©ãƒ¼", "å¤©å€™", "ã„ã¡ã”", "ãƒ–ãƒ«ãƒ¼ãƒ™ãƒªãƒ¼", "ã‚Šã‚“ã”", "ã‚µãƒœãƒ†ãƒ³", "ã¶ã©ã†", "ã™ã„ã‹", 
            "ã‚³ã‚³ãƒŠãƒƒãƒ„", "ãƒãƒ³ã‚´ãƒ¼", "ã‚·ãƒ¥ã‚¬ãƒ¼ã‚¢ãƒƒãƒ—ãƒ«", "ã‚¹ã‚¿ãƒ¼ãƒ•ãƒ«ãƒ¼ãƒ„", "ã«ã‚“ã˜ã‚“", "ãƒˆãƒãƒˆ", 
            "ã¨ã†ã‚‚ã‚ã“ã—", "ã‚­ãƒã‚³", "ã‹ã¼ã¡ã‚ƒ", "è±†ã®æœ¨", "ãƒˆã‚¥ãƒ¼ã‚¹ã‚­ãƒã‚³", "ä¸€ã¤ç›®ã‚­ãƒã‚³", 
            "é­”å¥³ã‚­ãƒã‚³", "ã‚³ã‚¦ãƒ¢ãƒªã‚­ãƒã‚³", "ãƒˆã‚¥ãƒ¼ã‚¹ãƒˆã‚²èŠ±", "ãƒˆã‚¥ãƒ¼ã‚¹ã‚¹ã‚¤ã‚»ãƒ³", "é¬¼ç«ã‚­ãƒã‚³", 
            "æ‚ªéœŠã™ã„ã‹", "ãƒã‚¯ã‚¿ãƒªãƒ³", "å¤ä»£ã®æœå®Ÿ", "çµ¶å«ã‚«ãƒœãƒãƒ£", "ã‚¤ãƒã‚¸ã‚¯", "ãƒˆã‚²ãƒãƒ³ãƒ¬ã‚¤ã‚·", "ãƒ‘ãƒ‘ã‚¤ãƒ¤"
        ];

        // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ç”Ÿæˆ
        const container = document.getElementById('check-list-container');
        TARGETS.forEach(item => {
            const label = document.createElement('label');
            label.className = 'check-item';
            label.innerHTML = `<input type="checkbox" value="${item}" checked> ${item}`;
            container.appendChild(label);
        });

        // éŸ³å£°ã‚¹ã‚¤ãƒƒãƒã®æŒ™å‹•
        document.getElementById('audio-switch').addEventListener('change', function() {
            const label = document.getElementById('audio-label');
            if(this.checked) {
                label.classList.add('active-audio');
                playNotifySound(); // ãƒ†ã‚¹ãƒˆéŸ³
            } else {
                label.classList.remove('active-audio');
            }
        });

        // ã‚¹ãƒªãƒ¼ãƒ—é˜²æ­¢ã‚¹ã‚¤ãƒƒãƒã®æŒ™å‹•
        document.getElementById('nosleep-switch').addEventListener('change', function() {
            const label = document.getElementById('nosleep-label');
            if(this.checked) {
                noSleep.enable();
                label.classList.add('active-nosleep');
            } else {
                noSleep.disable();
                label.classList.remove('active-nosleep');
            }
        });

        function allCheck(bool) { document.querySelectorAll('#settings input').forEach(cb => cb.checked = bool); }

        function updateTimers() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString();
            if (nextRefreshTime) {
                const diff = Math.max(0, Math.floor((nextRefreshTime - now) / 1000));
                document.getElementById('countdown').innerText = `æ›´æ–°ã¾ã§: ã‚ã¨ ${diff} ç§’`;
                if (diff <= 0) {
                    nextRefreshTime = null;
                    setTimeout(() => { fetchLog(); calculateNextTime(); }, 1500);
                }
            }
        }
        setInterval(updateTimers, 1000);

        function calculateNextTime() {
            const now = new Date();
            const min = now.getMinutes();
            let nextMin = (Math.floor(min / 5) * 5) + 6;
            const target = new Date();
            target.setMinutes(nextMin); target.setSeconds(0); target.setMilliseconds(0);
            nextRefreshTime = target;
        }

        async function fetchLog() {
            try {
                const response = await fetch(GIST_URL + "?t=" + new Date().getTime());
                const currentContent = await response.text();
                const audioOn = document.getElementById('audio-switch').checked;
                
                if (lastContent !== "" && currentContent !== lastContent) {
                    const latestLine = currentContent.split('\n')[0];
                    const selectedTargets = Array.from(document.querySelectorAll('#settings input:checked')).map(cb => cb.value);
                    if (selectedTargets.some(t => latestLine.includes(t)) && audioOn) playNotifySound();
                }
                document.getElementById('log-container').innerText = currentContent;
                lastContent = currentContent;
            } catch (e) { console.error(e); }
        }

        function playNotifySound() {
            const context = new (window.AudioContext || window.webkitAudioContext)();
            const gain = context.createGain();
            gain.connect(context.destination);
            const playTone = (freq, start, duration) => {
                const osc = context.createOscillator();
                osc.frequency.setValueAtTime(freq, context.currentTime + start);
                osc.connect(gain);
                gain.gain.setValueAtTime(0.1, context.currentTime + start);
                osc.start(context.currentTime + start);
                osc.stop(context.currentTime + start + duration);
            };
            playTone(880, 0, 0.1); playTone(1046.5, 0.15, 0.1);
        }

        fetchLog();
        calculateNextTime();
    </script>
</body>
</html>
