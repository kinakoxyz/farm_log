<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>è¾²åœ’ãƒ­ã‚° ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼ï¼ˆæ¥ç¶šä¿®æ­£ç‰ˆï¼‰</title>
    <style>
        body { background: #1a1a1a; color: #00ff00; font-family: 'Courier New', monospace; margin: 20px; text-align: center; }
        .info { color: #cccccc; font-size: 0.8em; margin-bottom: 10px; }
        #log-container { 
            width: 90%; max-width: 800px; height: 75vh; margin: 0 auto;
            border: 1px solid #333; background: #000; padding: 15px;
            text-align: left; overflow-y: auto; white-space: pre-wrap;
            box-shadow: inset 0 0 10px #003300;
        }
        .click-notice { color: #ffaa00; font-weight: bold; cursor: pointer; padding: 10px; border: 2px solid #ffaa00; display: inline-block; margin-bottom: 15px; }
    </style>
</head>
<body>
    <h3>è¾²åœ’ãƒœãƒƒãƒˆ ãƒ©ã‚¤ãƒ–ãƒ­ã‚° ğŸ””</h3>
    <div id="click-me" class="click-notice">ã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦éŸ³å£°é€šçŸ¥ã‚’æœ‰åŠ¹ã«ã™ã‚‹</div>
    <div id="status" class="info">æ¬¡å›æ›´æ–°ã‚’è¨ˆç®—ä¸­...</div>
    
    <div id="log-container">ãƒ­ã‚°ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>

    <script>
        let lastContent = "";
        let audioEnabled = false;
        const GIST_URL = "https://gist.githubusercontent.com/kinakoxyz/9b9509f9f4a9139ad6196042de197560/raw/";

        // ç”»é¢ã‚¯ãƒªãƒƒã‚¯ã§éŸ³å£°è¨±å¯
        document.addEventListener('click', () => {
            audioEnabled = true;
            document.getElementById('click-me').style.backgroundColor = '#332200';
            document.getElementById('click-me').innerText = 'âœ… éŸ³å£°é€šçŸ¥ ON';
        });

        // ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹é–¢æ•°
        async function fetchLog() {
            try {
                // ã‚­ãƒ£ãƒƒã‚·ãƒ¥å›é¿ã®ãŸã‚ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ä»˜ä¸
                const response = await fetch(GIST_URL + "?t=" + new Date().getTime());
                const currentContent = await response.text();

                // å†…å®¹ã«å¤‰åŒ–ãŒã‚ã‚Œã°éŸ³ã‚’é³´ã‚‰ã™
                if (lastContent !== "" && currentContent !== lastContent && audioEnabled) {
                    playNotifySound();
                }

                // ç”»é¢ã‚’æ›´æ–°
                document.getElementById('log-container').innerText = currentContent;
                lastContent = currentContent;
            } catch (e) {
                document.getElementById('log-container').innerText = "ã‚¨ãƒ©ãƒ¼: ãƒ­ã‚°ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n" + e;
            }
        }

        // æ¬¡ã®ã€Œ5åˆ†+1åˆ†ã€ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¾ã§å¾…æ©Ÿã™ã‚‹ãƒ«ãƒ¼ãƒ—
        function scheduleNextRefresh() {
            const now = new Date();
            const min = now.getMinutes();
            const sec = now.getSeconds();

            // æ¬¡ã®ç›®æ¨™ï¼ˆ5ã®å€æ•° + 1åˆ†ï¼‰ã‚’è¨ˆç®—
            let nextMin = (Math.floor(min / 5) * 5) + 6;
            
            const target = new Date();
            target.setMinutes(nextMin);
            target.setSeconds(0);
            target.setMilliseconds(0);

            const diff = target.getTime() - now.getTime();
            
            document.getElementById('status').innerText = 
                "æœ€çµ‚æ›´æ–°: " + now.toLocaleTimeString() + " | æ¬¡å›è‡ªå‹•æ›´æ–°: " + target.getHours() + ":" + String(target.getMinutes()).padStart(2, '0') + ":00";

            setTimeout(async () => {
                await fetchLog();
                scheduleNextRefresh(); // æ¬¡ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚»ãƒƒãƒˆ
            }, diff);
        }

        // èµ·å‹•æ™‚ã®å‡¦ç†
        fetchLog();
        scheduleNextRefresh();

        // ç°¡æ˜“çš„ãªé€šçŸ¥éŸ³
        function playNotifySound() {
            const context = new (window.AudioContext || window.webkitAudioContext)();
            const osc = context.createOscillator();
            const gain = context.createGain();
            osc.type = "sine";
            osc.connect(gain);
            gain.connect(context.destination);
            
            osc.frequency.setValueAtTime(880, context.currentTime);
            gain.gain.setValueAtTime(0.1, context.currentTime);
            osc.start();
            osc.stop(context.currentTime + 0.15);
            
            setTimeout(() => {
                const osc2 = context.createOscillator();
                osc2.connect(gain);
                osc2.frequency.setValueAtTime(1046.5, context.currentTime); // å°‘ã—é«˜ã„éŸ³
                osc2.start();
                osc2.stop(context.currentTime + 0.15);
            }, 150);
        }
    </script>
</body>
</html>