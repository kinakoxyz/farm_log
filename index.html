<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>è¾²åœ’ãƒ­ã‚° ãƒ©ã‚¤ãƒ–ãƒ“ãƒ¥ãƒ¼ (é€šçŸ¥è¨­å®šä»˜ã)</title>
    <style>
        body { background: #1a1a1a; color: #00ff00; font-family: 'Courier New', monospace; margin: 10px; display: flex; flex-direction: column; align-items: center; }
        .header { text-align: center; margin-bottom: 10px; }
        .status { color: #cccccc; font-size: 0.8em; margin-bottom: 10px; }
        
        /* è¨­å®šã‚¨ãƒªã‚¢ */
        #settings { 
            background: #252525; border: 1px solid #444; padding: 10px; width: 95%; max-width: 800px;
            margin-bottom: 10px; display: flex; flex-wrap: wrap; justify-content: center; gap: 8px;
        }
        .check-item { background: #333; padding: 3px 8px; border-radius: 4px; font-size: 0.85em; color: #eee; cursor: pointer; }
        .check-item input { cursor: pointer; }
        
        /* ãƒ­ã‚°ã‚¨ãƒªã‚¢ */
        #log-container { 
            width: 95%; max-width: 800px; height: 60vh; 
            border: 1px solid #333; background: #000; padding: 15px;
            text-align: left; overflow-y: auto; white-space: pre-wrap;
            box-shadow: inset 0 0 10px #003300; font-size: 0.9em;
        }
        .click-notice { color: #ffaa00; font-weight: bold; cursor: pointer; padding: 10px; border: 2px solid #ffaa00; margin-bottom: 10px; width: 95%; max-width: 800px; text-align: center; }
    </style>
</head>
<body>
    <div class="header">
        <h3>è¾²åœ’ãƒœãƒƒãƒˆ ãƒ©ã‚¤ãƒ–ãƒ­ã‚° ğŸ””</h3>
    </div>

    <div id="click-me" class="click-notice">ã€ã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦éŸ³å£°ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã€‘</div>
    <div id="status" class="status">æ¬¡å›æ›´æ–°ã‚’è¨ˆç®—ä¸­...</div>

    <div id="settings">
        <div style="width:100%; text-align:center; font-size:0.8em; color:#aaa; margin-bottom:5px;">é€šçŸ¥éŸ³ã‚’é³´ã‚‰ã™ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’é¸æŠ</div>
        <div id="check-list-container" style="display:contents;"></div>
        <div style="width:100%; text-align:center; margin-top:5px;">
            <button onclick="allCheck(true)" style="font-size:0.7em;">å…¨é¸æŠ</button>
            <button onclick="allCheck(false)" style="font-size:0.7em;">å…¨è§£é™¤</button>
        </div>
    </div>
    
    <div id="log-container">ãƒ­ã‚°ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>

    <script>
        const GIST_URL = "https://gist.githubusercontent.com/kinakoxyz/9b9509f9f4a9139ad6196042de197560/raw/";
        let lastContent = "";
        let audioEnabled = false;

        // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒªã‚¹ãƒˆ
        const TARGETS = [
            "ã‚¹ãƒ—ãƒªãƒ³ã‚¯ãƒ©ãƒ¼", "å¤©å€™", "ã„ã¡ã”", "ãƒ–ãƒ«ãƒ¼ãƒ™ãƒªãƒ¼", "ã‚Šã‚“ã”", "ã‚µãƒœãƒ†ãƒ³", "ã¶ã©ã†", "ã™ã„ã‹", 
            "ã‚³ã‚³ãƒŠãƒƒãƒ„", "ãƒãƒ³ã‚´ãƒ¼", "ã‚·ãƒ¥ã‚¬ãƒ¼ã‚¢ãƒƒãƒ—ãƒ«", "ã‚¹ã‚¿ãƒ¼ãƒ•ãƒ«ãƒ¼ãƒ„", "ã«ã‚“ã˜ã‚“", "ãƒˆãƒãƒˆ", 
            "ã¨ã†ã‚‚ã‚ã“ã—", "ã‚­ãƒã‚³", "ã‹ã¼ã¡ã‚ƒ", "è±†ã®æœ¨", "ãƒˆã‚¥ãƒ¼ã‚¹ã‚­ãƒã‚³", "ä¸€ã¤ç›®ã‚­ãƒã‚³", 
            "é­”å¥³ã‚­ãƒã‚³", "ã‚³ã‚¦ãƒ¢ãƒªã‚­ãƒã‚³", "ãƒˆã‚¥ãƒ¼ã‚¹ãƒˆã‚²èŠ±", "ãƒˆã‚¥ãƒ¼ã‚¹ã‚¹ã‚¤ã‚»ãƒ³", "é¬¼ç«ã‚­ãƒã‚³", 
            "æ‚ªéœŠã™ã„ã‹", "ãƒã‚¯ã‚¿ãƒªãƒ³", "å¤ä»£ã®æœå®Ÿ", "çµ¶å«ã‚«ãƒœãƒãƒ£", "ã‚¤ãƒã‚¸ã‚¯", "ãƒˆã‚²ãƒãƒ³ãƒ¬ã‚¤ã‚·", "ãƒ‘ãƒ‘ã‚¤ãƒ¤"
        ];

        // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ç”Ÿæˆ
        const container = document.getElementById('check-list-container');
        TARGETS.forEach(item => {
            const label = document.createElement('label');
            label.className = 'check-item';
            label.innerHTML = `<input type="checkbox" value="${item}" checked> ${item}`;
            container.appendChild(label);
        });

        function allCheck(bool) {
            document.querySelectorAll('#settings input').forEach(cb => cb.checked = bool);
        }

        document.addEventListener('click', () => {
            if(!audioEnabled){
                audioEnabled = true;
                document.getElementById('click-me').style.display = 'none';
            }
        });

        async function fetchLog() {
            try {
                const response = await fetch(GIST_URL + "?t=" + new Date().getTime());
                const currentContent = await response.text();

                if (lastContent !== "" && currentContent !== lastContent) {
                    const lines = currentContent.split('\n');
                    const latestLine = lines[0]; 

                    // ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹é …ç›®ã‚’å–å¾—
                    const selectedTargets = Array.from(document.querySelectorAll('#settings input:checked')).map(cb => cb.value);
                    
                    // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹åˆ¤å®š
                    const hit = selectedTargets.some(target => latestLine.includes(target));
                    
                    if (hit && audioEnabled) {
                        playNotifySound();
                    }
                }
                document.getElementById('log-container').innerText = currentContent;
                lastContent = currentContent;
            } catch (e) {
                document.getElementById('log-container').innerText = "å–å¾—ã‚¨ãƒ©ãƒ¼: " + e;
            }
        }

        function scheduleNextRefresh() {
            const now = new Date();
            const min = now.getMinutes();
            let nextMin = (Math.floor(min / 5) * 5) + 6;
            const target = new Date();
            target.setMinutes(nextMin); target.setSeconds(0); target.setMilliseconds(0);
            const diff = target.getTime() - now.getTime();
            document.getElementById('status').innerText = "æœ€çµ‚æ›´æ–°: " + now.toLocaleTimeString() + " | æ¬¡å›æ›´æ–°: " + target.getHours() + ":" + String(target.getMinutes()).padStart(2, '0') + ":00";
            setTimeout(async () => { await fetchLog(); scheduleNextRefresh(); }, diff);
        }

        function playNotifySound() {
            const context = new (window.AudioContext || window.webkitAudioContext)();
            const gain = context.createGain();
            gain.connect(context.destination);
            const playTone = (freq, start, duration) => {
                const osc = context.createOscillator();
                osc.type = "sine";
                osc.frequency.setValueAtTime(freq, context.currentTime + start);
                osc.connect(gain);
                gain.gain.setValueAtTime(0.1, context.currentTime + start);
                osc.start(context.currentTime + start);
                osc.stop(context.currentTime + start + duration);
            };
            playTone(880, 0, 0.1);    // ãƒ”
            playTone(1046.5, 0.15, 0.1); // ãƒ”ãƒƒ
        }

        fetchLog();
        scheduleNextRefresh();
    </script>
</body>
</html>
